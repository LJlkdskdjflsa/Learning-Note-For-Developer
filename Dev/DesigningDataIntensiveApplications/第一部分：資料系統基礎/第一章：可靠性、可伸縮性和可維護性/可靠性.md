### 可靠性
- 硬體故障
- 軟體錯誤
- 人為錯誤

人們對可靠軟體的典型期望包括：
- 應用程式表現出使用者所期望的功能。
- 允許使用者犯錯，允許使用者以出乎意料的方式使用軟體。
- 在預期的負載和資料量下，效能滿足要求。
- 系統能防止未經授權的訪問和濫用。

:::info
可以把可靠性粗略理解為 “即使出現問題，也能繼續正確工作”

造成錯誤的原因叫做 **故障（fault）**
能預料並應對故障的系統特性可稱為 **容錯（fault-tolerant）** 或 **韌性（resilient）**

故障（fault）vs 失效（failure）
**故障** 通常定義為系統的一部分狀態偏離其標準
**失效** 則是系統作為一個整體停止向用戶提供服務
故障的概率不可能降到零，因此最好設計容錯機制以防因 **故障** 而導致 **失效**。

:::

反直覺的是，在這類容錯系統中，透過故意觸發來提高故障率是有意義的
例如：在沒有警告的情況下隨機地殺死單個程序。許多高危漏洞實際上是由糟糕的錯誤處理導致的，因此我們可以透過故意引發故障來確保容錯機制不斷執行並接受考驗，從而提高故障自然發生時系統能正確處理的信心。Netflix 公司的 _Chaos Monkey就是這種方法的一個例子。

比起阻止錯誤（prevent error)，我們通常更傾向於容忍錯誤。但也有 預防勝於治療的情況（比如不存在治療方法時）。安全問題就屬於這種情況。
例如，如果攻擊者破壞了系統，並獲取了敏感資料，這種事是撤銷不了的。

#### 硬體故障
隨著資料量和應用計算需求的增加，越來越多的應用開始大量使用機器，這會相應地增加硬體故障率。此外，在類似亞馬遜 AWS（Amazon Web Services）的一些雲服務平臺上，虛擬機器例項不可用卻沒有任何警告也是很常見的，因為雲平臺的設計就是優先考慮 **靈活性（flexibility）** 和 **彈性（elasticity）**，而不是單機可靠性。

#### 軟體錯誤
硬體故障是隨機的、相互獨立的

##### 系統性錯誤（systematic error）。
這類錯誤難以預料，而且因為是跨節點相關的，所以比起不相關的硬體故障往往可能造成更多的 **系統失效**。例子包括：
-   接受特定的錯誤輸入，便導致所有應用伺服器例項崩潰的 BUG。例如 2012 年 6 月 30 日的閏秒，由於 Linux 核心中的一個錯誤【9】，許多應用同時掛掉了。
-   失控程序會用盡一些共享資源，包括 CPU 時間、記憶體、磁碟空間或網路頻寬。
-   系統依賴的服務變慢，沒有響應，或者開始返回錯誤的響應。
-   級聯故障，一個元件中的小故障觸發另一個元件中的故障，進而觸發更多的故障【10】。

導致這類軟體故障的 BUG 通常會潛伏很長時間，直到被異常情況觸發為止。這種情況意味著軟體對其環境做出了某種假設 —— 雖然這種假設通常來說是正確的，但由於某種原因最後不再成立了。

沒有速效藥，還是有很多小辦法
例如：
- 仔細考慮系統中的假設和互動
- 徹底的測試
- 程序隔離
- 允許程序崩潰並重啟
- 測量、監控並分析生產環境中的系統行為
- 如果系統能夠提供一些保證（例如在一個訊息佇列中，進入與發出的訊息數量相等），那麼系統就可以在執行時不斷自檢，並在出現 **差異（discrepancy）** 時報警

#### 人為錯誤
設計並構建了軟體系統的工程師是人類，維持系統執行的運維也是人類。
人類是不可靠的。

怎麼做才能讓系統變得可靠？最好的系統會組合使用以下幾種辦法：
- 最小化犯錯機會的方式設計系統
    - 精心設計的抽象、API 和管理後臺
    - 但如果介面限制太多，人們就會忽略它們的好處而想辦法繞開。很難正確把握這種微妙的平衡。
- 將人們最容易犯錯的地方與可能導致失效的地方 **解耦（decouple）**
    - 提供一個功能齊全的非生產環境 **沙箱（sandbox）**
    - 可以在不影響真實使用者的情況下，使用真實資料安全地探索和實驗。
- 在各個層次進行徹底的測試
    - 單元測試
    - 全系統整合測試
    - 手動測試
    - 自動化測試特別適合用來覆蓋正常情況中少見的 **邊緣場景（corner case）**。
- 允許從人為錯誤中簡單快速地恢復，以最大限度地減少失效情況帶來的影響
    - 快速回滾配置變更
    - 分批發布新程式碼（以便任何意外錯誤隻影響一小部分使用者）
    - 提供資料重算工具（以備舊的計算出錯）
- 配置詳細和明確的監控，比如效能指標和錯誤率。 
    - **遙測（telemetry）**（一旦火箭離開了地面，遙測技術對於跟蹤發生的事情和理解失敗是至關重要的）
    - 監控可以發出預警訊號
    - 允許我們檢查是否有任何地方違反了假設和約束
    - 良好的管理實踐與充分的培訓
